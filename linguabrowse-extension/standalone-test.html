<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinguaBrowse Standalone Test</title>
  <link rel="stylesheet" href="styles/overlay.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h1, h2, h3 {
      color: #2563eb;
    }
    
    p {
      margin: 16px 0;
    }
    
    .article {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 24px;
      margin: 32px 0;
      background-color: #f9fafb;
    }
    
    .article-title {
      font-size: 24px;
      margin-top: 0;
    }
    
    .highlight {
      background-color: #fef3c7;
      padding: 2px 4px;
      border-radius: 4px;
    }
    
    .test-controls {
      background-color: #eff6ff;
      padding: 16px;
      border-radius: 8px;
      margin-top: 40px;
    }
    
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    
    button:hover {
      background-color: #1d4ed8;
    }
    
    .debug-log {
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    
    .log-entry {
      margin: 4px 0;
      border-bottom: 1px solid #eee;
      padding-bottom: 4px;
    }
    
    .linguabrowse-quiz-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .linguabrowse-quiz-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .linguabrowse-quiz-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .linguabrowse-logo {
      font-weight: bold;
      color: #2563eb;
    }
    
    .linguabrowse-close {
      cursor: pointer;
      font-size: 24px;
    }
    
    .linguabrowse-quiz-content {
      padding: 16px;
    }
    
    .linguabrowse-quiz-question {
      font-size: 18px;
      margin-bottom: 16px;
    }
    
    .linguabrowse-quiz-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .linguabrowse-quiz-option {
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    
    .linguabrowse-quiz-option:hover {
      background-color: #f3f4f6;
    }
    
    .linguabrowse-correct {
      background-color: #d1fae5;
      border-color: #34d399;
    }
    
    .linguabrowse-incorrect {
      background-color: #fee2e2;
      border-color: #f87171;
    }
    
    .linguabrowse-feedback-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .linguabrowse-feedback-icon.correct {
      color: #10b981;
    }
    
    .linguabrowse-feedback-icon.incorrect {
      color: #ef4444;
    }
    
    .linguabrowse-next-button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 16px;
    }
    
    .linguabrowse-audio-button {
      background: none;
      border: none;
      color: #2563eb;
      cursor: pointer;
      padding: 4px;
      margin-left: 4px;
    }
    
    .linguabrowse-audio-button.playing {
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>LinguaBrowse Standalone Test</h1>
  
  <p>This page contains sample content and test controls to demonstrate the LinguaBrowse extension with added features:</p>
  <ul>
    <li><strong>Audio Pronunciation</strong> - Hear words spoken with audio buttons</li>
    <li><strong>Spaced Repetition</strong> - Track learning progress with optimized scheduling</li>
    <li><strong>Enhanced Dictionary</strong> - Expanded word information with examples</li>
  </ul>
  
  <div class="article">
    <h2 class="article-title">The Benefits of Learning a New Language</h2>
    
    <p>Learning a new <span class="highlight">language</span> is one of the most rewarding experiences you can undertake. It opens doors to new cultures, enhances your cognitive abilities, and improves your career prospects. Whether you're learning for personal or professional reasons, the benefits are numerous.</p>
    
    <p>When you learn a language, your <span class="highlight">brain</span> creates new neural pathways. This mental exercise has been shown to improve memory, enhance problem-solving skills, and even delay the onset of dementia. It's like a workout for your mind!</p>
    
    <h3>Cultural Understanding</h3>
    
    <p>Language and culture are deeply intertwined. By learning a <span class="highlight">language</span>, you gain insights into the values, traditions, and worldview of its speakers. You can read literature in its original form, watch films without subtitles, and connect with people on a deeper level when you travel.</p>
    
    <p>For example, understanding the concept of "hygge" in Danish, "wabi-sabi" in Japanese, or "sobremesa" in Spanish gives you access to cultural ideas that don't have direct translations in English.</p>
    
    <h3>Career Advantages</h3>
    
    <p>In today's global economy, speaking more than one <span class="highlight">language</span> is a valuable skill. Many employers seek candidates who can communicate with international partners, clients, or customers. Depending on the languages you learn and your industry, being bilingual or multilingual could increase your salary by 5-20%.</p>
    
    <p>Languages particularly in demand include Mandarin Chinese, Spanish, Arabic, and German, though the specific value varies by region and sector.</p>
  </div>
  
  <div class="test-controls">
    <h3>Testing Controls</h3>
    <p>Use these buttons to test specific functionality:</p>
    <button id="test-audio">1. Test Audio Service</button>
    <button id="test-spaced-repetition">2. Test Spaced Repetition</button>
    <button id="test-dictionary">3. Test Dictionary</button>
    <button id="test-results-screen">4. Test Results Screen</button>
    <button id="test-google-translate">5. Test Google Translate</button>
    
    <div class="debug-log" id="debug-log">
      <div class="log-entry">Debug log - actions will appear here</div>
    </div>
  </div>
  
<script src="js/services/googleTranslateService-browser.js"></script>
<script>
    // Define the global state for the mock content
    window.state = {
      settings: {
        targetLanguage: 'spanish',
        quizFrequency: 'high',
        subscription: 'premium',
        dailyGoal: 10
      },
      stats: {
        quizzesToday: 0,
        streakDays: 7,
        wordsLearned: 52
      },
      pageLanguage: 'english',
      quizActive: false,
      quizQueue: [],
      currentSequence: [
        {
          word: 'language',
          translatedWord: 'idioma',
          sourceElement: document.querySelector('.highlight')
        },
        {
          word: 'brain',
          translatedWord: 'cerebro',
          sourceElement: document.querySelector('.highlight:nth-child(2)')
        },
        {
          word: 'culture',
          translatedWord: 'cultura',
          sourceElement: document.querySelector('p')
        },
        {
          word: 'learning',
          translatedWord: 'aprendizaje',
          sourceElement: document.querySelector('p')
        },
        {
          word: 'career',
          translatedWord: 'carrera',
          sourceElement: document.querySelector('p')
        }
      ],
      currentQuestionIndex: 0,
      sequenceActive: false,
      sequenceCorrectAnswers: 3
    };
    
    // Debug logging function
    function logDebug(message) {
      const logContainer = document.getElementById('debug-log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = message;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
      console.log(message);
    }

    // Create mock services if they don't exist yet
    if (!window.audioService) {
      // Mock Audio Service
      window.audioService = {
        pronounceWord: async function(word, language) {
          logDebug(`[Audio Service] Playing pronunciation for '${word}' in ${language}`);
          return true;
        },
        isLanguageSupported: function(language) {
          return ['spanish', 'french', 'german', 'mandarin', 'english'].includes(language.toLowerCase());
        }
      };
    }

    if (!window.spacedRepetition) {
      // Mock Spaced Repetition Service
      window.spacedRepetition = {
        processReview: function(word, language, performance) {
          logDebug(`[Spaced Repetition] Processing review for '${word}' in ${language} with performance ${performance}`);
          return { interval: Math.floor(performance * 5) };
        },
        prioritizeWords: function(words, language, count) {
          logDebug(`[Spaced Repetition] Prioritizing ${count} words from list of ${words.length}`);
          return words.slice(0, count);
        },
        getDueWords: function(language, limit) {
          logDebug(`[Spaced Repetition] Getting ${limit} due words for ${language}`);
          return ['language', 'culture', 'learning'];
        }
      };
    }

    if (!window.dictionaryService) {
      // Mock Dictionary Service
      window.dictionaryService = {
        getWordData: async function(word, language) {
          logDebug(`[Dictionary] Looking up '${word}' in ${language}`);
          
          // Some sample words
          const sampleWords = {
            'language': {
              word: 'language',
              translations: ['idioma', 'lengua', 'lenguaje'],
              partOfSpeech: 'noun',
              difficulty: 'beginner',
              examples: [
                {
                  original: "What language do you speak?",
                  translated: "¿Qué idioma hablas?"
                }
              ]
            },
            'brain': {
              word: 'brain',
              translations: ['cerebro', 'mente'],
              partOfSpeech: 'noun',
              difficulty: 'beginner',
              examples: [
                {
                  original: "The human brain is complex.",
                  translated: "El cerebro humano es complejo."
                }
              ]
            }
          };
          
          return sampleWords[word] || {
            word: word,
            translations: [word], // Default translation is same word
            partOfSpeech: 'unknown',
            difficulty: 'intermediate',
            examples: []
          };
        },
        getTranslations: async function(word, fromLanguage, toLanguage) {
          logDebug(`[Dictionary] Translating '${word}' from ${fromLanguage} to ${toLanguage}`);
          const wordData = await this.getWordData(word, fromLanguage);
          return wordData.translations;
        }
      };
    }
    
    // Test functions
    document.getElementById('test-audio').addEventListener('click', async function() {
      logDebug('Testing Audio Service...');
      
      const testWords = ['language', 'brain', 'culture'];
      
      for (const word of testWords) {
        await audioService.pronounceWord(word, 'english');
        await new Promise(resolve => setTimeout(resolve, 500));
        
        const translation = await dictionaryService.getTranslations(word, 'english', 'spanish');
        await audioService.pronounceWord(translation[0], 'spanish');
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      logDebug('Audio Service test complete ✓');
    });
    
    document.getElementById('test-spaced-repetition').addEventListener('click', function() {
      logDebug('Testing Spaced Repetition Service...');
      
      // Test processing reviews
      spacedRepetition.processReview('language', 'spanish', 1.0); // Perfect performance
      spacedRepetition.processReview('brain', 'spanish', 0.5); // Medium performance
      spacedRepetition.processReview('culture', 'spanish', 0.2); // Poor performance
      
      // Test prioritizing words
      const words = ['language', 'brain', 'culture', 'learning', 'career', 'benefit'];
      const prioritized = spacedRepetition.prioritizeWords(words, 'spanish', 3);
      logDebug(`Prioritized words: ${prioritized.join(', ')}`);
      
      // Test due words
      const dueWords = spacedRepetition.getDueWords('spanish', 2);
      logDebug(`Due words: ${dueWords.join(', ')}`);
      
      logDebug('Spaced Repetition Service test complete ✓');
    });
    
    document.getElementById('test-dictionary').addEventListener('click', async function() {
      logDebug('Testing Dictionary Service...');
      
      // Test looking up words
      const languageData = await dictionaryService.getWordData('language', 'english');
      logDebug(`'language' data: ${languageData.translations.join(', ')} (${languageData.partOfSpeech})`);
      
      const brainData = await dictionaryService.getWordData('brain', 'english');
      logDebug(`'brain' data: ${brainData.translations.join(', ')} (${brainData.partOfSpeech})`);
      
      // Test unknown word
      const unknownData = await dictionaryService.getWordData('xylophone', 'english');
      logDebug(`'xylophone' data: ${unknownData.translations.join(', ')} (${unknownData.partOfSpeech})`);
      
      logDebug('Dictionary Service test complete ✓');
    });
    
    document.getElementById('test-results-screen').addEventListener('click', function() {
      logDebug('Showing quiz results screen...');
      
      // Create results overlay
      const resultsOverlay = document.createElement('div');
      resultsOverlay.className = 'linguabrowse-quiz-overlay';
      
      // Calculate score percentage
      const scorePercentage = Math.round((state.sequenceCorrectAnswers / state.currentSequence.length) * 100);
      
      // Create results content
      let resultsMessage;
      if (scorePercentage >= 80) {
        resultsMessage = "Great job! You're making excellent progress.";
      } else if (scorePercentage >= 60) {
        resultsMessage = "Good work! Keep practicing to improve.";
      } else {
        resultsMessage = "Practice makes perfect. Keep going!";
      }
      
      // Create word list HTML
      const wordsListHTML = state.currentSequence.map(item => `
        <div class="linguabrowse-word-pair">
          <span class="linguabrowse-word-original">
            ${item.word}
            <button class="linguabrowse-audio-button" data-word="${item.word}" data-language="english">
              <i class="linguabrowse-audio-icon">🔊</i>
            </button>
          </span>
          <span class="linguabrowse-word-translation">
            ${item.translatedWord}
            <button class="linguabrowse-audio-button" data-word="${item.translatedWord}" data-language="spanish">
              <i class="linguabrowse-audio-icon">🔊</i>
            </button>
          </span>
        </div>
      `).join('');
      
      // Create HTML structure
      resultsOverlay.innerHTML = `
        <div class="linguabrowse-quiz-container">
          <div class="linguabrowse-quiz-header">
            <div class="linguabrowse-logo">LinguaBrowse</div>
            <div class="linguabrowse-close">×</div>
          </div>
          <div class="linguabrowse-quiz-content">
            <div class="linguabrowse-results-container">
              <div class="linguabrowse-results-title">Quiz Complete!</div>
              <div class="linguabrowse-results-score">${state.sequenceCorrectAnswers}/${state.currentSequence.length}</div>
              <div class="linguabrowse-results-message">${resultsMessage}</div>
              
              <div class="linguabrowse-results-title">Words Covered:</div>
              <div class="linguabrowse-results-words">
                ${wordsListHTML}
              </div>
              
              <button class="linguabrowse-next-button">Continue Browsing</button>
            </div>
          </div>
        </div>
      `;
      
      // Add to page
      document.body.appendChild(resultsOverlay);
      
      // Set up event listeners
      const closeButton = resultsOverlay.querySelector('.linguabrowse-close');
      const continueButton = resultsOverlay.querySelector('.linguabrowse-next-button');
      const audioButtons = resultsOverlay.querySelectorAll('.linguabrowse-audio-button');
      
      // Close button handler
      closeButton.addEventListener('click', () => {
        document.body.removeChild(resultsOverlay);
        logDebug('Results screen closed');
      });
      
      // Continue button handler
      continueButton.addEventListener('click', () => {
        document.body.removeChild(resultsOverlay);
        logDebug('Results screen closed with continue button');
      });
      
      // Set up audio button handlers
      audioButtons.forEach(button => {
        button.addEventListener('click', async (event) => {
          event.stopPropagation(); // Prevent event bubbling
          
          const word = button.getAttribute('data-word');
          const language = button.getAttribute('data-language');
          
          // Add playing class for animation
          button.classList.add('playing');
          
          try {
            // Use our audio service to play the pronunciation
            await audioService.pronounceWord(word, language);
            
            // Remove playing class after a delay
            setTimeout(() => {
              button.classList.remove('playing');
            }, 1000);
            
            logDebug(`Played audio for "${word}" in ${language}`);
          } catch (error) {
            console.error('Error playing pronunciation:', error);
            button.classList.remove('playing');
          }
        });
      });
      
      logDebug('Results screen showing');
    });
    
    // Google Translate test function
    document.getElementById('test-google-translate').addEventListener('click', async function() {
      logDebug('Testing Google Translate Service...');
      
      // Test translating various words to different languages
      const wordTests = [
        { word: 'projects', targetLang: 'spanish' },
        { word: 'language', targetLang: 'french' },
        { word: 'learning', targetLang: 'german' },
        { word: 'computer', targetLang: 'mandarin' }
      ];
      
      for (const test of wordTests) {
        const translation = await window.googleTranslateService.translateText(
          test.word, 
          test.targetLang, 
          'english'
        );
        
        logDebug(`"${test.word}" in ${test.targetLang}: "${translation}"`);
      }
      
      // Test unknown word
      const unknownTranslation = await window.googleTranslateService.translateText(
        'cryptocurrency', 
        'spanish', 
        'english'
      );
      logDebug(`Unknown word "cryptocurrency" in spanish: "${unknownTranslation}"`);
      
      // Test caching
      logDebug('Testing cache with repeat translation:');
      const cachedTranslation = await window.googleTranslateService.translateText(
        'projects', 
        'spanish', 
        'english'
      );
      logDebug(`Cached "projects" in spanish: "${cachedTranslation}"`);
      
      // Get usage stats
      const stats = window.googleTranslateService.getUsageStats();
      logDebug(`Translation usage: ${stats.charactersUsedToday}/${stats.dailyLimit} characters (${stats.percentUsed.toFixed(2)}%)`);
      
      logDebug('Google Translate Service test complete ✓');
    });
      
      // Create results overlay
      const resultsOverlay = document.createElement('div');
      resultsOverlay.className = 'linguabrowse-quiz-overlay';
      
      // Calculate score percentage
      const scorePercentage = Math.round((state.sequenceCorrectAnswers / state.currentSequence.length) * 100);
      
      // Create results content
      let resultsMessage;
      if (scorePercentage >= 80) {
        resultsMessage = "Great job! You're making excellent progress.";
      } else if (scorePercentage >= 60) {
        resultsMessage = "Good work! Keep practicing to improve.";
      } else {
        resultsMessage = "Practice makes perfect. Keep going!";
      }
      
      // Create word list HTML
      const wordsListHTML = state.currentSequence.map(item => `
        <div class="linguabrowse-word-pair">
          <span class="linguabrowse-word-original">
            ${item.word}
            <button class="linguabrowse-audio-button" data-word="${item.word}" data-language="english">
              <i class="linguabrowse-audio-icon">🔊</i>
            </button>
          </span>
          <span class="linguabrowse-word-translation">
            ${item.translatedWord}
            <button class="linguabrowse-audio-button" data-word="${item.translatedWord}" data-language="spanish">
              <i class="linguabrowse-audio-icon">🔊</i>
            </button>
          </span>
        </div>
      `).join('');
      
      // Create HTML structure
      resultsOverlay.innerHTML = `
        <div class="linguabrowse-quiz-container">
          <div class="linguabrowse-quiz-header">
            <div class="linguabrowse-logo">LinguaBrowse</div>
            <div class="linguabrowse-close">×</div>
          </div>
          <div class="linguabrowse-quiz-content">
            <div class="linguabrowse-results-container">
              <div class="linguabrowse-results-title">Quiz Complete!</div>
              <div class="linguabrowse-results-score">${state.sequenceCorrectAnswers}/${state.currentSequence.length}</div>
              <div class="linguabrowse-results-message">${resultsMessage}</div>
              
              <div class="linguabrowse-results-title">Words Covered:</div>
              <div class="linguabrowse-results-words">
                ${wordsListHTML}
              </div>
              
              <button class="linguabrowse-next-button">Continue Browsing</button>
            </div>
          </div>
        </div>
      `;
      
      // Add to page
      document.body.appendChild(resultsOverlay);
      
      // Set up event listeners
      const closeButton = resultsOverlay.querySelector('.linguabrowse-close');
      const continueButton = resultsOverlay.querySelector('.linguabrowse-next-button');
      const audioButtons = resultsOverlay.querySelectorAll('.linguabrowse-audio-button');
      
      // Close button handler
      closeButton.addEventListener('click', () => {
        document.body.removeChild(resultsOverlay);
        logDebug('Results screen closed');
      });
      
      // Continue button handler
      continueButton.addEventListener('click', () => {
        document.body.removeChild(resultsOverlay);
        logDebug('Results screen closed with continue button');
      });
      
      // Set up audio button handlers
      audioButtons.forEach(button => {
        button.addEventListener('click', async (event) => {
          event.stopPropagation(); // Prevent event bubbling
          
          const word = button.getAttribute('data-word');
          const language = button.getAttribute('data-language');
          
          // Add playing class for animation
          button.classList.add('playing');
          
          try {
            // Use our audio service to play the pronunciation
            await audioService.pronounceWord(word, language);
            
            // Remove playing class after a delay
            setTimeout(() => {
              button.classList.remove('playing');
            }, 1000);
            
            logDebug(`Played audio for "${word}" in ${language}`);
          } catch (error) {
            console.error('Error playing pronunciation:', error);
            button.classList.remove('playing');
          }
        });
      });
      
      logDebug('Results screen showing');
    });
  </script>
</body>
</html>
